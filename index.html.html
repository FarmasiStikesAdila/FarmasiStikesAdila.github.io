<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SelfCare - Pencatatan Obat Mandiri</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --danger: #F44336;
            --warning: #FFC107;
            --light: #f8f9fa;
            --dark: #343a40;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .auth-container {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 30px auto;
            max-width: 500px;
        }
        
        .auth-container.active {
            display: block;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            background-color: #e0e0e0;
            border: none;
            font-weight: bold;
        }
        
        .auth-tab.active {
            background-color: var(--primary);
            color: white;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3e8e41;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
        }
        
        .btn-secondary:hover {
            background-color: #0b7dda;
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .otp-container {
            display: none;
            margin-top: 15px;
        }
        
        .otp-container.active {
            display: block;
        }
        
        .info-section {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 30px 0;
        }
        
        .info-section h2 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .info-section .warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 5px solid #ffeeba;
        }
        
        .info-section .benefits {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 5px solid #c3e6cb;
        }
        
        .medication-form {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 30px 0;
        }
        
        .medication-form h2 {
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .time-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .time-option {
            flex: 1;
            text-align: center;
        }
        
        .time-option input {
            display: none;
        }
        
        .time-option label {
            display: block;
            padding: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .time-option input:checked + label {
            background-color: var(--primary);
            color: white;
        }
        
        .meal-options {
            display: flex;
            gap: 10px;
        }
        
        .meal-option {
            flex: 1;
            text-align: center;
        }
        
        .meal-option input {
            display: none;
        }
        
        .meal-option label {
            display: block;
            padding: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .meal-option input:checked + label {
            background-color: var(--primary);
            color: white;
        }
        
        .history-section {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin: 30px 0;
        }
        
        .history-section h2 {
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .history-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-item .med-info {
            flex: 1;
        }
        
        .history-item .med-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .history-item .med-details {
            display: flex;
            gap: 15px;
            color: #666;
            font-size: 14px;
        }
        
        .history-item .delete-btn {
            color: var(--danger);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
        }
        
        .notification-permission {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .time-options, .meal-options {
                flex-direction: column;
            }
            
            .history-item .med-details {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>SelfCare</h1>
            <p>Pencatatan Obat Mandiri yang Aman dan Terkontrol</p>
        </div>
    </header>
    
    <div class="container">
        <!-- Authentication Section -->
        <div id="auth-container" class="auth-container active">
            <div class="auth-tabs">
                <button class="auth-tab active" id="login-tab">Masuk</button>
                <button class="auth-tab" id="register-tab">Daftar</button>
            </div>
            
            <!-- Login Form -->
            <div id="login-form">
                <div class="form-group">
                    <label for="login-email">Email atau Nomor Telepon</label>
                    <input type="text" id="login-email" placeholder="Masukkan email atau nomor telepon">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Masukkan password">
                </div>
                <button class="btn" id="login-btn">Masuk</button>
                <p style="margin-top: 15px; text-align: center;">Belum punya akun? <a href="#" id="show-register">Daftar disini</a></p>
            </div>
            
            <!-- Register Form -->
            <div id="register-form" style="display: none;">
                <div class="form-group">
                    <label for="register-name">Nama Lengkap</label>
                    <input type="text" id="register-name" placeholder="Masukkan nama lengkap">
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" placeholder="Masukkan email">
                </div>
                <div class="form-group">
                    <label for="register-phone">Nomor Telepon</label>
                    <input type="tel" id="register-phone" placeholder="Masukkan nomor telepon">
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" placeholder="Buat password">
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">Konfirmasi Password</label>
                    <input type="password" id="register-confirm-password" placeholder="Ulangi password">
                </div>
                
                <div class="otp-container" id="email-otp-container">
                    <div class="form-group">
                        <label for="email-otp">Kode OTP Email</label>
                        <input type="text" id="email-otp" placeholder="Masukkan kode OTP dari email">
                    </div>
                    <button class="btn btn-secondary" id="verify-email-otp">Verifikasi Email</button>
                </div>
                
                <div class="otp-container" id="phone-otp-container">
                    <div class="form-group">
                        <label for="phone-otp">Kode OTP SMS</label>
                        <input type="text" id="phone-otp" placeholder="Masukkan kode OTP dari SMS">
                    </div>
                    <button class="btn btn-secondary" id="verify-phone-otp">Verifikasi Nomor Telepon</button>
                </div>
                
                <button class="btn" id="register-btn">Daftar</button>
                <p style="margin-top: 15px; text-align: center;">Sudah punya akun? <a href="#" id="show-login">Masuk disini</a></p>
            </div>
        </div>
        
        <!-- Main Content (shown after login) -->
        <div id="main-content" style="display: none;">
            <!-- Information Section -->
            <section class="info-section">
                <h2>Pentingnya Pencatatan Obat Mandiri</h2>
                <div class="warning">
                    <h3><i class="fas fa-exclamation-triangle"></i> Bahaya Self-Medication</h3>
                    <p>Pengobatan mandiri tanpa pengawasan dokter dapat berbahaya karena:</p>
                    <ul>
                        <li>Risiko salah diagnosis dan pengobatan yang tidak tepat</li>
                        <li>Efek samping obat yang tidak terpantau</li>
                        <li>Interaksi obat yang berbahaya</li>
                        <li>Resistensi antibiotik akibat penggunaan yang tidak tepat</li>
                        <li>Overdosis atau underdosis</li>
                    </ul>
                </div>
                
                <div class="benefits">
                    <h3><i class="fas fa-check-circle"></i> Manfaat Pencatatan Obat</h3>
                    <p>Dengan mencatat konsumsi obat secara teratur, Anda dapat:</p>
                    <ul>
                        <li>Memantau jadwal minum obat dengan tepat</li>
                        <li>Menghindari overdosis atau lupa minum obat</li>
                        <li>Memberikan informasi akurat pada tenaga kesehatan</li>
                        <li>Mengidentifikasi reaksi alergi atau efek samping</li>
                        <li>Mengoptimalkan efek terapi obat</li>
                    </ul>
                </div>
            </section>
            
            <!-- Notification Permission -->
            <div class="notification-permission">
                <div>
                    <h3><i class="fas fa-bell"></i> Aktifkan Notifikasi</h3>
                    <p>Dapatkan pengingat minum obat bahkan saat browser ditutup</p>
                </div>
                <button class="btn btn-secondary" id="enable-notifications">
                    <i class="fas fa-bell"></i> Aktifkan
                </button>
            </div>
            
            <!-- Medication Form -->
            <section class="medication-form">
                <h2><i class="fas fa-pills"></i> Form Pencatatan Obat</h2>
                <form id="medication-form">
                    <div class="form-group">
                        <label for="med-name">Nama Obat</label>
                        <input type="text" id="med-name" placeholder="Masukkan nama obat" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="med-dosage">Dosis</label>
                        <input type="text" id="med-dosage" placeholder="Contoh: 1 tablet, 5 ml" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Waktu Minum</label>
                        <div class="time-options">
                            <div class="time-option">
                                <input type="radio" id="time-morning" name="time" value="pagi" checked>
                                <label for="time-morning">Pagi</label>
                            </div>
                            <div class="time-option">
                                <input type="radio" id="time-afternoon" name="time" value="siang">
                                <label for="time-afternoon">Siang</label>
                            </div>
                            <div class="time-option">
                                <input type="radio" id="time-evening" name="time" value="malam">
                                <label for="time-evening">Malam</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Waktu Makan</label>
                        <div class="meal-options">
                            <div class="meal-option">
                                <input type="radio" id="meal-before" name="meal" value="sebelum" checked>
                                <label for="meal-before">Sebelum Makan</label>
                            </div>
                            <div class="meal-option">
                                <input type="radio" id="meal-after" name="meal" value="sesudah">
                                <label for="meal-after">Sesudah Makan</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="med-time">Jam Minum</label>
                        <input type="time" id="med-time" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="med-next-time">Jam Minum Berikutnya</label>
                        <input type="time" id="med-next-time">
                    </div>
                    
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Simpan Catatan
                    </button>
                </form>
            </section>
            
            <!-- Medication History -->
            <section class="history-section">
                <h2><i class="fas fa-history"></i> Riwayat Obat</h2>
                <div id="medication-history">
                    <!-- History items will be added here dynamically -->
                </div>
            </section>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2023 SelfCare - Pencatatan Obat Mandiri. Hak Cipta Dilindungi.</p>
            <p>Disclaimer: Aplikasi ini tidak menggantikan konsultasi dengan tenaga kesehatan profesional.</p>
        </div>
    </footer>
    
    <script>
        // DOM Elements
        const authContainer = document.getElementById('auth-container');
        const mainContent = document.getElementById('main-content');
        const loginTab = document.getElementById('login-tab');
        const registerTab = document.getElementById('register-tab');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const showRegister = document.getElementById('show-register');
        const showLogin = document.getElementById('show-login');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const emailOtpContainer = document.getElementById('email-otp-container');
        const phoneOtpContainer = document.getElementById('phone-otp-container');
        const verifyEmailOtpBtn = document.getElementById('verify-email-otp');
        const verifyPhoneOtpBtn = document.getElementById('verify-phone-otp');
        const enableNotificationsBtn = document.getElementById('enable-notifications');
        const medicationForm = document.getElementById('medication-form');
        const medicationHistory = document.getElementById('medication-history');
        
        // Sample medication data
        let medications = JSON.parse(localStorage.getItem('medications')) || [];
        
        // Event Listeners
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
        });
        
        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            registerForm.style.display = 'block';
            loginForm.style.display = 'none';
        });
        
        showRegister.addEventListener('click', (e) => {
            e.preventDefault();
            registerTab.click();
        });
        
        showLogin.addEventListener('click', (e) => {
            e.preventDefault();
            loginTab.click();
        });
        
        loginBtn.addEventListener('click', () => {
            // In a real app, you would validate credentials with a server
            authContainer.style.display = 'none';
            mainContent.style.display = 'block';
            renderMedicationHistory();
            initializeServiceWorker();
        });
        
        registerBtn.addEventListener('click', () => {
            // Validate form
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const phone = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            if (!name || !email || !phone || !password || !confirmPassword) {
                alert('Harap isi semua field!');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Password dan konfirmasi password tidak cocok!');
                return;
            }
            
            // In a real app, you would send OTP to email and phone
            emailOtpContainer.classList.add('active');
            phoneOtpContainer.classList.add('active');
            
            // For demo purposes, we'll just show the OTP fields
            alert('Kode OTP telah dikirim ke email dan nomor telepon Anda (simulasi)');
        });
        
        verifyEmailOtpBtn.addEventListener('click', () => {
            const otp = document.getElementById('email-otp').value;
            if (!otp) {
                alert('Harap masukkan kode OTP email');
                return;
            }
            
            // In a real app, you would verify the OTP with your server
            alert('Email berhasil diverifikasi!');
            emailOtpContainer.classList.remove('active');
        });
        
        verifyPhoneOtpBtn.addEventListener('click', () => {
            const otp = document.getElementById('phone-otp').value;
            if (!otp) {
                alert('Harap masukkan kode OTP SMS');
                return;
            }
            
            // In a real app, you would verify the OTP with your server
            alert('Nomor telepon berhasil diverifikasi!');
            phoneOtpContainer.classList.remove('active');
            
            // For demo purposes, we'll log the user in after verification
            authContainer.style.display = 'none';
            mainContent.style.display = 'block';
            renderMedicationHistory();
            initializeServiceWorker();
        });
        
        enableNotificationsBtn.addEventListener('click', () => {
            if (!('Notification' in window)) {
                alert('Browser ini tidak mendukung notifikasi desktop');
            } else if (Notification.permission === 'granted') {
                alert('Notifikasi sudah diaktifkan sebelumnya');
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        alert('Notifikasi berhasil diaktifkan! Anda akan menerima pengingat minum obat.');
                    }
                });
            }
        });
        
        medicationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const medName = document.getElementById('med-name').value;
            const dosage = document.getElementById('med-dosage').value;
            const time = document.querySelector('input[name="time"]:checked').value;
            const meal = document.querySelector('input[name="meal"]:checked').value;
            const medTime = document.getElementById('med-time').value;
            const nextTime = document.getElementById('med-next-time').value;
            
            const medication = {
                id: Date.now(),
                name: medName,
                dosage: dosage,
                time: time,
                meal: meal,
                medTime: medTime,
                nextTime: nextTime,
                timestamp: new Date().toISOString()
            };
            
            medications.push(medication);
            localStorage.setItem('medications', JSON.stringify(medications));
            
            // Reset form
            medicationForm.reset();
            
            // Update history
            renderMedicationHistory();
            
            // Schedule notification
            scheduleNotification(medication);
            
            alert('Catatan obat berhasil disimpan!');
        });
        
        // Functions
        function renderMedicationHistory() {
            if (medications.length === 0) {
                medicationHistory.innerHTML = '<p>Belum ada riwayat obat.</p>';
                return;
            }
            
            medicationHistory.innerHTML = '';
            
            medications.forEach(med => {
                const medItem = document.createElement('div');
                medItem.className = 'history-item';
                medItem.innerHTML = `
                    <div class="med-info">
                        <div class="med-name">${med.name}</div>
                        <div class="med-details">
                            <span><i class="fas fa-prescription-bottle-alt"></i> ${med.dosage}</span>
                            <span><i class="fas fa-clock"></i> ${med.time} (${med.meal} makan)</span>
                            <span><i class="fas fa-hourglass-start"></i> ${med.medTime}</span>
                            ${med.nextTime ? `<span><i class="fas fa-hourglass-end"></i> ${med.nextTime}</span>` : ''}
                        </div>
                    </div>
                    <button class="delete-btn" data-id="${med.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                medicationHistory.appendChild(medItem);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = parseInt(e.currentTarget.getAttribute('data-id'));
                    medications = medications.filter(med => med.id !== id);
                    localStorage.setItem('medications', JSON.stringify(medications));
                    renderMedicationHistory();
                });
            });
        }
        
        function initializeServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker berhasil didaftarkan');
                    })
                    .catch(err => {
                        console.log('Pendaftaran ServiceWorker gagal: ', err);
                    });
            }
        }
        
        function scheduleNotification(medication) {
            if (!('Notification' in window)) return;
            
            // Calculate time until medication time
            const now = new Date();
            const [hours, minutes] = medication.medTime.split(':').map(Number);
            const medDateTime = new Date();
            medDateTime.setHours(hours, minutes, 0, 0);
            
            // If time is already passed today, set for tomorrow
            if (medDateTime < now) {
                medDateTime.setDate(medDateTime.getDate() + 1);
            }
            
            const timeUntilNotification = medDateTime.getTime() - now.getTime();
            
            if (Notification.permission === 'granted') {
                setTimeout(() => {
                    // Show browser notification
                    new Notification(`Waktu Minum Obat: ${medication.name}`, {
                        body: `Dosis: ${medication.dosage} - ${medication.time} (${medication.meal} makan)`,
                        icon: 'icon.png'
                    });
                    
                    // Show service worker notification (works when app is closed)
                    if ('serviceWorker' in navigator) {
                        navigator.serviceWorker.ready.then(registration => {
                            registration.showNotification(`Waktu Minum Obat: ${medication.name}`, {
                                body: `Dosis: ${medication.dosage} - ${medication.time} (${medication.meal} makan)`,
                                icon: 'icon.png'
                            });
                        });
                    }
                }, timeUntilNotification);
            }
        }
        
        // Initialize
        if (localStorage.getItem('loggedIn')) {
            authContainer.style.display = 'none';
            mainContent.style.display = 'block';
            renderMedicationHistory();
            initializeServiceWorker();
        }
    </script>
</body>
</html>